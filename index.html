<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Peta Kabupaten/Kota Rev</title>
<link rel="stylesheet" href="resources/ol.css">
<link rel="stylesheet" href="resources/ol-layerswitcher.css">
<link rel="stylesheet" href="resources/choices.min.css">
<style>
    html, body {
        margin: 0;
        padding: 0;
        height: 100%;
    }
    #map {
        width: 100%;
        height: calc(100% - 50px);
    }
    #kabupatenSelect {
        width: 300px;
        margin: 10px;
    }
</style>
</head>
<body>

<!-- Dropdown Kabupaten/Kota -->
<select id="kabupatenSelect" placeholder="Pilih Kabupaten/Kota"></select>

<!-- Peta -->
<div id="map">
    <div id="popup" class="ol-popup">
        <a href="#" id="popup-closer" class="ol-popup-closer"></a>
        <div id="popup-content"></div>
    </div>
</div>

<script src="resources/ol.js"></script>
<script src="resources/ol-layerswitcher.js"></script>
<script src="resources/choices.min.js"></script>
<script src="resources/qgis2web_expressions.js"></script>
<script src="resources/functions.js"></script>

<!-- Semua layer hasil export -->
<!-- Contoh: tambahkan semua file layers dan styles hasil qgis2web -->
<script src="layers/Gresik_32.js"></script>
<!-- ... semua layers lainnya -->
<script src="layers/layers.js"></script>
<script src="resources/qgis2web.js"></script>

<script>
window.onload = function() {
    const selectElem = document.getElementById("kabupatenSelect");

    // Ambil daftar kabupaten/kota dari popuplayertitle di layersList
    const kabupatenList = layersList
        .filter(l => l.get('popuplayertitle') && !l.get('title').includes('Batas'))
        .map(l => l.get('popuplayertitle'))
        .filter((v, i, a) => a.indexOf(v) === i) // unik
        .sort();

    // Isi dropdown
    kabupatenList.forEach(name => {
        let option = document.createElement("option");
        option.value = name;
        option.textContent = name;
        selectElem.appendChild(option);
    });

    // Aktifkan pencarian
    const choices = new Choices('#kabupatenSelect', { searchEnabled: true, itemSelectText: '' });

    // Zoom ke kabupaten saat dipilih
    selectElem.addEventListener("change", function() {
        let selectedName = this.value;
        layersList.forEach(layer => {
            if (layer.get('popuplayertitle') === selectedName) {
                let src = layer.getSource();
                if (src && src.getFeatures().length > 0) {
                    let extent = src.getExtent();
                    map.getView().fit(extent, { duration: 1000, padding: [50,50,50,50] });
                }
            }
        });
    });

    // Hover efek kuning untuk semua layer kabupaten/kota
    let hoverInteraction = new ol.interaction.Select({
        condition: ol.events.condition.pointerMove,
        layers: layersList.filter(l => l.get('popuplayertitle') && !l.get('title').includes('Batas')),
        style: new ol.style.Style({
            stroke: new ol.style.Stroke({ color: 'yellow', width: 2 }),
            fill: new ol.style.Fill({ color: 'rgba(255, 255, 0, 0.3)' })
        })
    });
    map.addInteraction(hoverInteraction);
};
</script>

</body>
</html>
