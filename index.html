<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="initial-scale=1,width=device-width,maximum-scale=1,user-scalable=no">
<link rel="stylesheet" href="./resources/ol.css">
<link rel="stylesheet" href="resources/fontawesome-all.min.css">
<link href="resources/photon-geocoder-autocomplete.min.css" rel="stylesheet">
<link rel="stylesheet" href="./resources/ol-layerswitcher.css">
<link rel="stylesheet" href="./resources/qgis2web.css">
<style>
    html, body {
        margin: 0;
        padding: 0;
        height: 100%;
        background-color: #ffffff;
        font-family: Arial, sans-serif;
    }
    #sidebar {
        width: 300px;
        height: 100%;
        float: left;
        background: white;
        padding: 15px;
        box-sizing: border-box;
        overflow-y: auto;
        border-right: 1px solid #ccc;
    }
    #map {
        width: calc(100% - 300px);
        height: 100%;
        float: right;
    }
    .legend-box {
        margin-top: 20px;
    }
    .legend-item {
        display: flex;
        align-items: center;
        margin-bottom: 6px;
    }
    .legend-color {
        width: 20px;
        height: 20px;
        margin-right: 8px;
    }
    .highlight {
        stroke: yellow;
        stroke-width: 3;
    }
</style>
<title>ESG Jawa Timur</title>
</head>
<body>

<div id="sidebar">
    <h2 style="margin-top:0">ESG Jawa Timur</h2>
    <label for="select-kabupaten">Pilih Kabupaten:</label>
    <select id="select-kabupaten" style="width:100%; margin-bottom:10px;"></select>
    <div class="legend-box">
        <strong>Legenda:</strong>
        <div class="legend-item"><div class="legend-color" style="background:green;"></div>Klaster 1</div>
        <div class="legend-item"><div class="legend-color" style="background:orange;"></div>Klaster 2</div>
        <div class="legend-item"><div class="legend-color" style="background:red;"></div>Klaster 3</div>
    </div>
</div>

<div id="map">
    <div id="popup" class="ol-popup">
        <a href="#" id="popup-closer" class="ol-popup-closer"></a>
        <div id="popup-content"></div>
    </div>
</div>

<script src="resources/qgis2web_expressions.js"></script>
<script src="./resources/functions.js"></script>
<script src="./resources/ol.js"></script>
<script src="./resources/ol-layerswitcher.js"></script>
<script src="resources/photon-geocoder-autocomplete.min.js"></script>

<!-- Semua layer kabupaten -->
<script src="layers/Pacitan_1.js"></script>
<script src="layers/Ponorogo_2.js"></script>
<script src="layers/Trenggalek_3.js"></script>
<script src="layers/Tulungagung_4.js"></script>
<script src="layers/Blitar_5.js"></script>
<script src="layers/KotaBlitar_6.js"></script>
<script src="layers/Kediri_7.js"></script>
<script src="layers/KotaKediri_8.js"></script>
<script src="layers/Malang_9.js"></script>
<script src="layers/KotaMalang_10.js"></script>
<script src="layers/Lumajang_11.js"></script>
<script src="layers/Jember_12.js"></script>
<script src="layers/Banyuwangi_13.js"></script>
<script src="layers/Bondowoso_14.js"></script>
<script src="layers/Situbondo_15.js"></script>
<script src="layers/Probolinggo_16.js"></script>
<script src="layers/KotaProbolinggo_17.js"></script>
<script src="layers/Pasuruan_18.js"></script>
<script src="layers/KotaPasuruan_19.js"></script>
<script src="layers/Sidoarjo_20.js"></script>
<script src="layers/Mojokerto_21.js"></script>
<script src="layers/KotaMojokerto_22.js"></script>
<script src="layers/Jombang_23.js"></script>
<script src="layers/Ngajuk_24.js"></script>
<script src="layers/Madiun_25.js"></script>
<script src="layers/KotaMadiun_26.js"></script>
<script src="layers/Magetan_27.js"></script>
<script src="layers/Ngawi_28.js"></script>
<script src="layers/Bojonegoro_29.js"></script>
<script src="layers/Tuban_30.js"></script>
<script src="layers/Lamongan_31.js"></script>
<script src="layers/Gresik_32.js"></script>
<script src="layers/Bangkalan_33.js"></script>
<script src="layers/Sampang_34.js"></script>
<script src="layers/Pamekasan_35.js"></script>
<script src="layers/Sumenep_36.js"></script>
<script src="layers/Surabaya_37.js"></script>
<script src="layers/Batu_38.js"></script>
<script src="layers/BatasKabupaten_39.js"></script>

<!-- Styles -->
<script src="styles/Pacitan_1_style.js"></script>
<script src="styles/Ponorogo_2_style.js"></script>
<script src="styles/Trenggalek_3_style.js"></script>
<script src="styles/Tulungagung_4_style.js"></script>
<script src="styles/Blitar_5_style.js"></script>
<script src="styles/KotaBlitar_6_style.js"></script>
<script src="styles/Kediri_7_style.js"></script>
<script src="styles/KotaKediri_8_style.js"></script>
<script src="styles/Malang_9_style.js"></script>
<script src="styles/KotaMalang_10_style.js"></script>
<script src="styles/Lumajang_11_style.js"></script>
<script src="styles/Jember_12_style.js"></script>
<script src="styles/Banyuwangi_13_style.js"></script>
<script src="styles/Bondowoso_14_style.js"></script>
<script src="styles/Situbondo_15_style.js"></script>
<script src="styles/Probolinggo_16_style.js"></script>
<script src="styles/KotaProbolinggo_17_style.js"></script>
<script src="styles/Pasuruan_18_style.js"></script>
<script src="styles/KotaPasuruan_19_style.js"></script>
<script src="styles/Sidoarjo_20_style.js"></script>
<script src="styles/Mojokerto_21_style.js"></script>
<script src="styles/KotaMojokerto_22_style.js"></script>
<script src="styles/Jombang_23_style.js"></script>
<script src="styles/Ngajuk_24_style.js"></script>
<script src="styles/Madiun_25_style.js"></script>
<script src="styles/KotaMadiun_26_style.js"></script>
<script src="styles/Magetan_27_style.js"></script>
<script src="styles/Ngawi_28_style.js"></script>
<script src="styles/Bojonegoro_29_style.js"></script>
<script src="styles/Tuban_30_style.js"></script>
<script src="styles/Lamongan_31_style.js"></script>
<script src="styles/Gresik_32_style.js"></script>
<script src="styles/Bangkalan_33_style.js"></script>
<script src="styles/Sampang_34_style.js"></script>
<script src="styles/Pamekasan_35_style.js"></script>
<script src="styles/Sumenep_36_style.js"></script>
<script src="styles/Surabaya_37_style.js"></script>
<script src="styles/Batu_38_style.js"></script>
<script src="styles/BatasKabupaten_39_style.js"></script>

<script src="./layers/layers.js" type="text/javascript"></script>
<script src="./resources/Autolinker.min.js"></script>
<script src="./resources/qgis2web.js"></script>

<script>
    // isi dropdown kabupaten
    const kabupatenList = [
        "Pacitan","Ponorogo","Trenggalek","Tulungagung","Blitar","KotaBlitar","Kediri","KotaKediri",
        "Malang","KotaMalang","Lumajang","Jember","Banyuwangi","Bondowoso","Situbondo","Probolinggo",
        "KotaProbolinggo","Pasuruan","KotaPasuruan","Sidoarjo","Mojokerto","KotaMojokerto","Jombang",
        "Ngajuk","Madiun","KotaMadiun","Magetan","Ngawi","Bojonegoro","Tuban","Lamongan","Gresik",
        "Bangkalan","Sampang","Pamekasan","Sumenep","Surabaya","Batu"
    ];
    const selectKabupaten = document.getElementById('select-kabupaten');
    kabupatenList.forEach(name => {
        const opt = document.createElement('option');
        opt.value = name;
        opt.textContent = name;
        selectKabupaten.appendChild(opt);
    });

    // zoom ke kabupaten
    selectKabupaten.addEventListener('change', function() {
        const selectedName = this.value;
        map.getLayers().forEach(layer => {
            if (layer.getSource && layer.getSource().getFeatures) {
                const features = layer.getSource().getFeatures().filter(f => {
                    return (f.get('Kabupaten') || f.get('Nama_Kabupaten')) === selectedName;
                });
                if (features.length) {
                    const extent = ol.extent.createEmpty();
                    features.forEach(f => ol.extent.extend(extent, f.getGeometry().getExtent()));
                    map.getView().fit(extent, { duration: 1000, padding: [50, 50, 50, 50] });
                }
            }
        });
    });

    // hover kuning
    const highlightStyle = new ol.style.Style({
        stroke: new ol.style.Stroke({ color: 'yellow', width: 3 }),
        fill: new ol.style.Fill({ color: 'rgba(255,255,0,0.3)' })
    });
    let highlight;
    map.on('pointermove', function(evt) {
        if (highlight) {
            highlight.setStyle(undefined);
            highlight = null;
        }
        map.forEachFeatureAtPixel(evt.pixel, function(feature) {
            highlight = feature;
            feature.setStyle(highlightStyle);
            return true;
        });
    });
</script>

</body>
</html>
